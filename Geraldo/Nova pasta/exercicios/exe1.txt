----- REGIAO ------
CREATE TABLE tb_regiao (
id_regiao     INTEGER NOT NULL,
nm_regiao     VARCHAR2(25),
CONSTRAINT pk_tb_regiao_id_regiao PRIMARY KEY(id_regiao)
);

----- PAIS ------
CREATE TABLE tb_pais(
id_pais       INTEGER NOT NULL,
nm_pais       VARCHAR2(40),
id_regiao     INTEGER,
CONSTRAINT pk_tb_pais_id_pais PRIMARY KEY(id_pais),
CONSTRAINT fk_tb_pais_tb_regiao_id_regiao FOREIGN KEY(id_pais)  REFERENCES tb_regiao(id_regiao)
);

----- LOCALIZACAO ------
CREATE TABLE tb_localizacao(
id_localizacao      INTEGER NOT NULL, 
id_pais             INTEGER NOT NULL,
endereco            VARCHAR2(40),
cep                 VARCHAR2(12),
cidade              VARCHAR2(30) NOT NULL,
estado              VARCHAR2(25),
CONSTRAINT pk_tb_localizacao_id_local PRIMARY KEY(id_localizacao),
CONSTRAINT ffk_tb_local_tb_pais_id_pais FOREIGN KEY(id_pais) REFERENCES tb_pais(id_pais)
);

---- SEQUENCIA ------
CREATE SEQUENCE seq_localizacao
START WITH 3300
INCREMENT BY 100
MAXVALUE 9900
NOCACHE
NOCYCLE


----- DEPARTAMENTO -----
CREATE TABLE tb_departamento(
id_departamento       INTEGER NOT NULL, 
nm_departamento       VARCHAR2(30) NOT NULL,
id_gerente            INTEGER, 
id_localizacao        INTEGER, 
CONSTRAINT pk_tb_departamento_id_dpt PRIMARY KEY(id_departamento),
CONSTRAINT fk_tb_departamento_id_loca FOREIGN KEY(id_localizacao) REFERENCES tb_localizacao(id_localizacao)
);

CREATE SEQUENCE  seq_departamento
START WITH 280
INCREMENT BY 10
MAXVALUE 9990
NOCACHE
NOCYCLE;

---- FUNCAO ------
CREATE TABLE tb_funcao(
id_funcao     INTEGER NOT NULL,
ds_funcao     VARCHAR2(35) NOT NULL,
base_salario  NUMBER(8,2),
teto_salario  NUMBER(8,2),
CONSTRAINT pk_tb_funcao_id_funcao PRIMARY KEY(id_funcao)
);

------ EMPREGADO --------
CREATE TABLE tb_empregado(
id_empregado          INTEGER,
nome                  VARCHAR2(15),
sobrenome             VARCHAR2(25) NOT NULL,
email                 VARCHAR2(25) NOT NULL,
telefone              VARCHAR2(20),
data_adimissao        DATE NOT NULL,
id_funcao             INTEGER, 
salario               NUMBER(8,2),
percentual_comissao   NUMBER(2, 2),
id_gerente            INTEGER,
id_departamento       INTEGER, 
CONSTRAINT pk_tb_empre_id_empre PRIMARY KEY(id_empregado),
CONSTRAINT fk_tb_empre_id_dpto_tb_dpto FOREIGN KEY(id_departamento) REFERENCES tb_departamento(id_departamento),
CONSTRAINT fk_tb_empre_id_func_tb_func FOREIGN KEY(id_funcao) REFERENCES tb_funcao(id_funcao),
CONSTRAINT fk_tb_empre_id_func_tb_empre FOREIGN KEY(id_gerente) REFERENCES tb_empregado(id_empregado),
CONSTRAINT check_salario CHECK (salario > 0)
);

CREATE SEQUENCE seq_empregado 
START WITH 207
INCREMENT BY 1
NOCACHE
NOCYCLE;
---------- ALTER TABLE DEPARTAMENTOS --------
ALTER TABLE tb_departamento ADD (CONSTRAINT fk_tb_depar_id_gerente_tb_empre FOREIGN KEY (id_gerente) REFERENCES tb_empregado(id_empregado))

---------- HISTORICO FUNCAO --------
CREATE TABLE tb_historico_funcao(
id_empregado      INTEGER NOT NULL,
data_inicio       DATE NOT NULL,
data_termino      DATE NOT NULL, 
id_funcao         INTEGER NOT NULL, 
id_departamento   INTEGER,
CONSTRAINT check_data_termino_tb_histfun CHECK (data_termino > data_inicio),
CONSTRAINT pk_tb_histfun_id_empregado PRIMARY KEY(id_empregado, data_inicio),
CONSTRAINT fk_tb_histfun_tb_funcao  FOREIGN KEY (id_funcao) REFERENCES tb_funcao(id_funcao),
CONSTRAINT fk_tb_histfun_tb_empregado FOREIGN KEY (id_empregado) REFERENCES tb_empregado(id_empregado),
CONSTRAINT fk_tb_histfun_tb_dpto FOREIGN KEY (id_departamento) REFERENCES tb_departamento(id_departamento)
);